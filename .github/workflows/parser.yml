name: Parse NHTK Schedule

on:
  schedule:
    # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 07:30 –ø–æ –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫—É (UTC+7)
    # 07:30 NSK = 00:30 UTC
    - cron: '30 0 * * *'
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫—É Actions

jobs:
  parse-and-upload:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # ‚ö° –ñ–µ—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üì¶ Install dependencies
        # ‚ö° –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É, –µ—Å–ª–∏ —ç—Ç–æ –ø–ª–∞–Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (—ç–∫–æ–Ω–æ–º–∏–º –≤—Ä–µ–º—è)
        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        if: github.event_name != 'schedule'
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: üîÑ Run parser
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          IS_SCHEDULED: 'true'
        run: python parser_supabase.py

      - name: üì§ Upload JSON artifact (–¢–û–õ–¨–ö–û –ø—Ä–∏ –æ—à–∏–±–∫–µ)
        # ‚ö° v4: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —à–∞–≥ –ø–∞—Ä—Å–µ—Ä–∞ —É–ø–∞–ª
        if: failure()
        uses: actions/upload-artifact@v4  # ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–æ v4
        with:
          name: debug-schedule-json
          path: nhtk_schedule.json
          retention-days: 5
          # –í v4 –ø–∞—Ä–∞–º–µ—Ç—Ä if-no-files-found –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
          if-no-files-found: ignore